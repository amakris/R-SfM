#include <iostream>
#include <cmath>
#include <unsupported/Eigen/Polynomials>
#include <Eigen/Geometry> 
#include <complex>
using namespace std;

//#include "../refraction.h"




template <typename T>
Refraction<T>::Refraction(T ior_) 
{
    ior = ior_;    
}

template <typename T>
BooleanVec Refraction<T>::CalcRMany(const Vec3<T> &E, const MatX3<T> &S, MatX3<T> &R) const 
{
  int N  = S.rows();
  R.resize(N, 3);
  BooleanVec ret(N);
  for (int i = 0; i < N; ++i) {
    Vec3<T> r;
    ret[i] = this->CalcR(E, S.row(i), r);
    R.row(i) = r;
  }
  return ret;
}


template <typename T>
bool Refraction<T>::CalcR(const Vec3<T> &E, const Vec3<T> &S, Vec3<T> &R) const 
{
    bool ret;
    //Check if the refractive interface (z=0) is between E and S.
    if ((E[2]*S[2]>=T(0.0))||(abs(S[2])<Refraction<T>::EPS_SZ)||(abs(ior-1.0) < Refraction<T>::EPS_IOR)) {
        R = S;
        ret = true;
    } else if ( (abs(E[0]-S[0]) < Refraction<T>::EPS_ES) && abs(E[1]-S[1]) < Refraction<T>::EPS_ES ) {
        R[0] = S[0];
        R[1] = S[1];
        R[2] = T(0.0);
        ret = true;
    } else {

        Eigen::Transform<T,3,Eigen::Affine> Rt;
        CalcRefractionPlane(E, S, Rt);
        
        //std::cout << "r:\n" << r.matrix() << std::endl;
        //std::cout << "t:\n" << t.matrix() << std::endl;
        //std::cout << "Rt:\n" << Rt.matrix() << std::endl;

        //Vec3<T> z(T(0.),T(0.),T(0.));
        //std::cout << "zero transormed:\n" << Rt * z << std::endl;
        //std::cout << "zero transormed inv:\n" << Rt.inverse() * z << std::endl;

        Vec3<T> Er = Rt.inverse() * E;
        Vec3<T> Sr = Rt.inverse() * S;
        //Vec2d e_r2(e_r3(2), e_r3(1));
        //Vec2d s_r2(s_r3(2), s_r3(1));
        //std::cout << "Er:\n" << Er << std::endl;
        //std::cout << "Sr:\n" << Sr << std::endl;

        T ry = T(0.);
        
        ret = this->SolveRy(Er(2), Sr(2), Sr(1), ry);        
        
        if (ret) {
            Vec3<T> Rr(T(0.),ry,T(0.));
            R = Rt * Rr;
        }         
    }
    return ret;
}


template <typename T>
bool Refraction<T>::CalcRefractionPlane(const Vec3<T> &E, const Vec3<T> &S, Eigen::Transform<T,3,Eigen::Affine> &Rt) const
{
        Vec2<T> e(E(0), E(1));
        Vec2<T> s(S(0), S(1));
        Vec2<T> es = s-e;
        Vec2<T> y(T(0.),T(1.));
        
        //T y_rot_angle1 = std::acos(y.dot(es.normalized()));
        T dot_prod = y.dot(es);
        T det_prod = -es[0];
        T y_rot_angle2 = atan2(det_prod, dot_prod);

        //std::cout << "E:\n" << E << std::endl;
        //std::cout << "S:\n" << S << std::endl;
        //std::cout << "es:\n" << es << std::endl;
        //std::cout << "y_rot_angle1:" << y_rot_angle1 << std::endl;
        //std::cout << "y_rot_angle2:" << y_rot_angle2 << std::endl;

        Eigen::AngleAxis<T> aa(y_rot_angle2, Vec3<T>::UnitZ());
        Eigen::Transform<T,3,Eigen::Affine> r(aa);
        Eigen::Transform<T,3,Eigen::Affine> t(Eigen::Translation<T, 3>(E(0), E(1), T(0.0)));
        // Rt: Transforms points from [Refr] -> [World] frame.
        Rt = t * r;
        return true;
}

template <typename T>
bool Refraction<T>::SolveRy(T e, T sx, T sy, T &ry) const
{
    //std::cout << " Using AnalyticR.\n" << std::endl;
    bool ret = false;
    auto r = ior;
    std::complex<T> R1 = T(0);
    std::complex<T> R2 = T(0);
    std::complex<T> R3 = T(0);
    std::complex<T> R4 = T(0);
    if (pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(T(1.0))/T(T(2.0))*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) + (T(1.0)/T(12.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)) == T(0)) {
     R1 = (T(1.0)/T(2.0))*sy - T(1.0)/T(2.0)*sqrt(pow(sy, T(2)) - T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + (T(1.0)/T(2.0))*sqrt(T(2)*pow(sy, T(2)) + (-T(4)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(4)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))/sqrt(pow(sy, T(2)) - T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(4.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)));
    }
   else {
      R1 = (T(1.0)/T(2.0))*sy - T(1.0)/T(2.0)*sqrt(pow(sy, T(2)) - T(2.0)/T(3.0)*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) + T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + (T(1.0)/T(2.0))*sqrt(T(2)*pow(sy, T(2)) + (-T(4)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(4)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))/sqrt(pow(sy, T(2)) - T(2.0)/T(3.0)*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) + T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + (T(2.0)/T(3.0))*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(4.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)));
   }


    
    if (pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) + (T(1.0)/T(12.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)) == T(0)) {
      R2 = (T(1.0)/T(2.0))*sy + (T(1.0)/T(2.0))*sqrt(pow(sy, T(2)) - T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) - T(1.0)/T(2.0)*sqrt(T(2)*pow(sy, T(2)) - (-T(4)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(4)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))/sqrt(pow(sy, T(2)) - T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(4.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)));
   }
   else {
      R2 = (T(1.0)/T(2.0))*sy + (T(1.0)/T(2.0))*sqrt(pow(sy, T(2)) - T(2.0)/T(3.0)*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) + T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) - T(1.0)/T(2.0)*sqrt(T(2)*pow(sy, T(2)) - (-T(4)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(4)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))/sqrt(pow(sy, T(2)) - T(2.0)/T(3.0)*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) + T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + (T(2.0)/T(3.0))*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(4.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)));
   }
    

    
    if (pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) + (T(1.0)/T(12.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)) == T(0)) {
      R3 = (T(1.0)/T(2.0))*sy - T(1.0)/T(2.0)*sqrt(pow(sy, T(2)) - T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) - T(1.0)/T(2.0)*sqrt(T(2)*pow(sy, T(2)) + (-T(4)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(4)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))/sqrt(pow(sy, T(2)) - T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(4.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)));
   }
   else {
      R3 = (T(1.0)/T(2.0))*sy - T(1.0)/T(2.0)*sqrt(pow(sy, T(2)) - T(2.0)/T(3.0)*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) + T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) - T(1.0)/T(2.0)*sqrt(T(2)*pow(sy, T(2)) + (-T(4)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(4)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))/sqrt(pow(sy, T(2)) - T(2.0)/T(3.0)*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) + T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + (T(2.0)/T(3.0))*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(4.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)));
   }

    
    if (pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) + (T(1.0)/T(12.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)) == T(0)) {
      R4 = (T(1.0)/T(2.0))*sy + (T(1.0)/T(2.0))*sqrt(pow(sy, T(2)) - T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + (T(1.0)/T(2.0))*sqrt(T(2)*pow(sy, T(2)) - (-T(4)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(4)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))/sqrt(pow(sy, T(2)) - T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + T(2)*cbrt(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2))) - T(4.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)));
   }
   else {
      R4 = (T(1.0)/T(2.0))*sy + (T(1.0)/T(2.0))*sqrt(pow(sy, T(2)) - T(2.0)/T(3.0)*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) + T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + (T(1.0)/T(2.0))*sqrt(T(2)*pow(sy, T(2)) - (-T(4)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(4)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))/sqrt(pow(sy, T(2)) - T(2.0)/T(3.0)*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) + T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))) + (T(2.0)/T(3.0))*(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)))/cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(2)*cbrt((T(1.0)/T(216.0))*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) - T(1.0)/T(6.0)*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) + (T(1.0)/T(16.0))*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)) + sqrt((T(1.0)/T(27.0))*pow(-pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) - T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))) - T(1.0)/T(12.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(2)), T(3)) + (T(1.0)/T(4.0))*pow(-T(1.0)/T(108.0)*pow(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)), T(3)) + (T(1.0)/T(3.0))*(-T(3.0)/T(2.0)*pow(sy, T(2)) + (pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)))*(pow(e, T(2))*pow(r, T(2))*pow(sy, T(2))/(pow(r, T(2)) - T(1)) + T(2)*sy*(-T(1.0)/T(2.0)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(3.0)/T(64.0))*pow(sy, T(2)) - T(1.0)/T(16.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))))) - T(1.0)/T(8.0)*pow(-T(2)*pow(e, T(2))*pow(r, T(2))*sy/(pow(r, T(2)) - T(1)) - T(2)*sy*((T(1.0)/T(2.0))*pow(sy, T(2)) - T(1.0)/T(2.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1))), T(2)), T(2)))) - T(4.0)/T(3.0)*(pow(e, T(2))*pow(r, T(2)) + pow(r, T(2))*pow(sy, T(2)) - pow(sx, T(2)) - pow(sy, T(2)))/(pow(r, T(2)) - T(1)));
   }

    std::vector<T> real_roots;
    if (abs(imag(R1) - T(0.0)) < Refraction<T>::EPS_IMG) {
        real_roots.push_back(real(R1));
    }
    if (abs(imag(R2) - T(0.0)) < Refraction<T>::EPS_IMG) {
        real_roots.push_back(real(R2));
    }
    if (abs(imag(R3) - T(0.0)) < Refraction<T>::EPS_IMG) {
        real_roots.push_back(real(R3));
    }
    if (abs(imag(R4) - T(0.0)) < Refraction<T>::EPS_IMG) {
        real_roots.push_back(real(R4));
    }
    if (real_roots.size() > 0) {
        T min_ry = std::min(T(0.0),  sy);    
        T max_ry = std::max(T(0.0),  sy);
        //std::cout << min_ry << " to " << max_ry << std::endl;
        for(auto& rt : real_roots)
        {
            //std::cout << rt << std::endl;
            if ((rt >= min_ry) && (rt <= max_ry)) {
                ry = rt;
                ret = true;
                break;
            }
            
        }
    }
    return ret;
}


template <typename T>
Vec3<T> Refraction<T>::Refract(const Vec3<T> &I, const Vec3<T> &N) const
{ 
    T cosi = std::clamp(I.dot(N), -1., 1.); 
    // std::cout << "I: " << I << std::endl;
    // std::cout << "N: " << N << std::endl;
    // std::cout << "cosi: " << cosi << std::endl;
    T etai = 1.0, etat = ior; 
    Vec3<T> n = N; 
    if (cosi < 0) { 
        cosi = -cosi; 
        // std::cout << "Inverting cosi." << std::endl;
    } else { 
        // std::cout << "Swapping etai etat." << std::endl;
        std::swap(etai, etat); 
        n = -N; 
    } 
    T eta = etai / etat; 
    T k = 1 - eta * eta * (1 - cosi * cosi); 
    // std::cout << "eta: " << eta << std::endl;
    // std::cout << "k: " << k << std::endl;
    if (k < 0) return Vec3<T>(T(0.),T(0.),T(0.));
    
    
    Vec3<T> D = eta * I + (eta * cosi - sqrtf(k)) * n;
    // std::cout << "D: " << D << std::endl;
    return D;
} 